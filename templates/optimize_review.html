{% extends "base.html" %}
{% block content %}
<div class="container-fluid px-0">
  <div class="card">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h2 class="h5 mb-0">Pre‑Optimization Review</h2>
      <span class="text-muted small">Algorithm: {{ algorithm or '—' }}</span>
    </div>
    <div class="card-body">

      <p class="mb-3">
        The following jobs will <strong>not</strong> be optimized (they’ll be skipped) due to constraints.
        You can review the details below and decide whether to continue.
      </p>

      <div class="mb-2">
        <span class="badge badge-secondary">Total jobs: {{ total_jobs }}</span>
        <span class="badge badge-success">Feasible: {{ feasible_count }}</span>
        <span class="badge badge-danger">To be skipped: {{ unscheduled|length }}</span>
      </div>

      <div class="table-responsive">
        <table class="table table-sm table-bordered table-hover">
          <thead class="thead-light">
            <tr>
              <th>Job ID</th>
              <th>Description</th>
              <th>Duration (h)</th>
              <th>Equipment</th>
              <th>Req. Skills</th>
              <th>Req. Tools</th>
              <th>Req. Materials</th>
              <th>Reason(s)</th>
            </tr>
          </thead>
          <tbody>
            {% for j in unscheduled %}
              <tr>
                <td class="text-monospace">{{ j.job_id }}</td>
                <td>{{ j.description }}</td>
                <td>{{ '%.2f'|format(j.duration) }}</td>
                <td class="text-monospace">{{ j.equipment_id }}</td>
                <td>
                  {% if j.required_skills %}{{ j.required_skills|join(', ') }}{% else %}<span class="text-muted">None</span>{% endif %}
                </td>
                <td>
                  {% if j.required_tools and j.required_tools|length %}
                    {% for t in j.required_tools %}
                      <div><span class="text-monospace">{{ t.tool_id }}</span>: {{ t.quantity }}</div>
                    {% endfor %}
                  {% else %}
                    <span class="text-muted">None</span>
                  {% endif %}
                </td>
                <td>
                  {% if j.required_materials and j.required_materials|length %}
                    {% for m in j.required_materials %}
                      <div><span class="text-monospace">{{ m.material_id }}</span>: {{ m.quantity }}</div>
                    {% endfor %}
                  {% else %}
                    <span class="text-muted">None</span>
                  {% endif %}
                </td>
                <td>
                  {% for r in j.reason %}
                    <div class="text-danger">• {{ r }}</div>
                  {% endfor %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-end mt-4">
        <a href="{{ url_for('optimize') }}" class="btn btn-outline-secondary mr-2">
          Cancel
        </a>
        <form method="post" action="{{ url_for('optimize') }}">
          <input type="hidden" name="algorithm" value="{{ algorithm }}">
          <input type="hidden" name="confirmed" value="1">
          <button type="submit" class="btn btn-primary">
            Continue &nbsp;—&nbsp; Proceed with Optimization
          </button>
        </form>
      </div>

    </div>
  </div>
</div>
{% endblock %}
